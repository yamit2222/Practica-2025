<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cursos Disponibles - Sistema de Cursos</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ GestiÃ³n de Cursos</h1>            <div class="user-info">                <span>ğŸ‘¤ Bienvenido, <strong th:text="${usuario.username}"></strong></span>
                <form th:action="@{/logout}" method="post" style="display: inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" style="background: none; border: none; color: var(--white); 
                            text-decoration: underline; cursor: pointer; font-size: inherit; padding: 8px 16px; 
                            border: 1px solid rgba(255, 255, 255, 0.3); border-radius: var(--border-radius); 
                            transition: var(--transition);" 
                            onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'" 
                            onmouseout="this.style.background='none'">
                        ğŸšª Cerrar sesiÃ³n
                    </button>
                </form>
            </div>
        </div>
        
        <div class="nav-links">
            <a th:href="@{/cursos/nuevo}" class="btn btn-primary">
                â• Nuevo Curso
            </a>
            <span style="color: var(--gray-dark);">
                ğŸ“Š Total de cursos: <strong th:text="${#lists.size(cursos)}"></strong>
            </span>
        </div>
        
        <div class="content">
            <!-- Vista de tarjetas para mÃ³vil y tablet -->
            <div class="course-cards" style="display: none;">
                <div th:each="curso : ${cursos}" class="course-card">
                    <div class="course-title">
                        <a th:href="@{'/cursos/' + ${curso.id}}" th:text="${curso.nombre}"></a>
                    </div>
                    
                    <div class="course-info">
                        <div class="course-stat">
                            <div class="course-stat-value">ğŸ‘¨â€ğŸ«</div>
                            <div class="course-stat-label" th:text="${curso.instructor}"></div>
                        </div>
                        <div class="course-stat">
                            <div class="course-stat-value" th:text="${curso.capacidad}"></div>
                            <div class="course-stat-label">Capacidad</div>
                        </div>
                        <div class="course-stat">
                            <div class="course-stat-value" th:text="${#lists.size(curso.inscripciones)}"></div>
                            <div class="course-stat-label">Inscritos</div>
                        </div>
                    </div>
                    
                    <div class="table-actions" style="justify-content: center; margin-top: 15px;">
                        <form th:action="@{'/cursos/' + ${curso.id} + '/inscribir'}" method="post" style="display:inline">
                            <button type="submit" class="btn btn-success btn-small" 
                                    th:disabled="${#lists.contains(inscripciones, curso)}">
                                âœ… Inscribirse
                            </button>
                        </form>
                        <form th:action="@{'/cursos/' + ${curso.id} + '/remover'}" method="post" style="display:inline">
                            <button type="submit" class="btn btn-warning btn-small" 
                                    th:if="${#lists.contains(inscripciones, curso)}">
                                âŒ Cancelar
                            </button>
                        </form>
                        <a th:href="@{'/cursos/' + ${curso.id} + '/editar'}" class="btn btn-primary btn-small">
                            âœï¸ Editar
                        </a>
                        <form th:action="@{'/cursos/' + ${curso.id} + '/eliminar'}" method="post" style="display:inline" 
                            onsubmit="return confirm('Â¿EstÃ¡s seguro de que quieres eliminar este curso?');">
                            <button type="submit" class="btn btn-danger btn-small">
                                ğŸ—‘ï¸ Eliminar
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Vista de tabla para escritorio -->
            <div class="table-container desktop-table">
                <table>
                    <thead>
                        <tr>
                            <th>ğŸ“š Nombre del Curso</th>
                            <th>ğŸ‘¨â€ğŸ« Instructor</th>
                            <th>ğŸ‘¥ Capacidad</th>
                            <th>âœ… Inscritos</th>
                            <th>ğŸ”§ Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="curso : ${cursos}">
                            <td>
                                <strong>
                                    <a th:href="@{'/cursos/' + ${curso.id}}" th:text="${curso.nombre}"></a>
                                </strong>
                            </td>
                            <td th:text="${curso.instructor}"></td>
                            <td>
                                <span class="tooltip" th:attr="data-tooltip='Capacidad mÃ¡xima del curso'">
                                    <strong th:text="${curso.capacidad}"></strong> personas
                                </span>
                            </td>
                            <td>
                                <span th:text="${#lists.size(curso.inscripciones)}"></span> / 
                                <span th:text="${curso.capacidad}"></span>
                                <div style="width: 100%; background: var(--gray-light); border-radius: 10px; height: 8px; margin-top: 5px;">
                                    <div style="width: calc(100% * ${#lists.size(curso.inscripciones)} / ${curso.capacidad}); 
                                                background: var(--secondary-color); height: 100%; border-radius: 10px;"></div>
                                </div>
                            </td>
                            <td>
                                <div class="table-actions">
                                    <form th:action="@{'/cursos/' + ${curso.id} + '/inscribir'}" method="post" style="display:inline">
                                        <button type="submit" class="btn btn-success btn-small" 
                                                th:disabled="${#lists.contains(inscripciones, curso)}"
                                                th:title="${#lists.contains(inscripciones, curso)} ? 'Ya estÃ¡s inscrito' : 'Inscribirse al curso'">
                                            <span th:if="${#lists.contains(inscripciones, curso)}">âœ… Inscrito</span>
                                            <span th:unless="${#lists.contains(inscripciones, curso)}">â• Inscribirse</span>
                                        </button>
                                    </form>
                                    <form th:action="@{'/cursos/' + ${curso.id} + '/remover'}" method="post" style="display:inline">
                                        <button type="submit" class="btn btn-warning btn-small" 
                                                th:if="${#lists.contains(inscripciones, curso)}"
                                                title="Cancelar inscripciÃ³n">
                                            âŒ Cancelar
                                        </button>
                                    </form>
                                    <a th:href="@{'/cursos/' + ${curso.id} + '/editar'}" class="btn btn-primary btn-small"
                                       title="Editar curso">
                                        âœï¸ Editar
                                    </a>
                                    <form th:action="@{'/cursos/' + ${curso.id} + '/eliminar'}" method="post" style="display:inline" 
                                        onsubmit="return confirm('Â¿EstÃ¡s seguro de que quieres eliminar este curso? Esta acciÃ³n no se puede deshacer.');">
                                        <button type="submit" class="btn btn-danger btn-small" title="Eliminar curso">
                                            ğŸ—‘ï¸ Eliminar
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Mensaje cuando no hay cursos -->
            <div th:if="${#lists.isEmpty(cursos)}" style="text-align: center; padding: 60px 20px;">
                <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“š</div>
                <h3 style="color: var(--gray-dark); margin-bottom: 10px;">No hay cursos disponibles</h3>
                <p style="color: var(--gray-dark); margin-bottom: 30px;">Â¡SÃ© el primero en crear un curso!</p>
                <a th:href="@{/cursos/nuevo}" class="btn btn-primary">
                    â• Crear Primer Curso
                </a>
            </div>
        </div>
    </div>

    <script>
        // Responsive behavior para cambiar entre vista de tabla y tarjetas
        function checkViewport() {
            const tableContainer = document.querySelector('.desktop-table');
            const cardsContainer = document.querySelector('.course-cards');
            
            if (window.innerWidth <= 768) {
                tableContainer.style.display = 'none';
                cardsContainer.style.display = 'block';
            } else {
                tableContainer.style.display = 'block';
                cardsContainer.style.display = 'none';
            }
        }
        
        // Ejecutar al cargar y al redimensionar
        checkViewport();
        window.addEventListener('resize', checkViewport);
        
        // ConfirmaciÃ³n mejorada para eliminaciÃ³n
        document.querySelectorAll('form[action*="/eliminar"]').forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const courseName = this.closest('tr')?.querySelector('td a')?.textContent || 
                                  this.closest('.course-card')?.querySelector('.course-title a')?.textContent;
                
                if (confirm(`ğŸ—‘ï¸ Â¿EstÃ¡s seguro de que quieres eliminar el curso "${courseName}"?\n\nEsta acciÃ³n no se puede deshacer y se eliminarÃ¡n todas las inscripciones.`)) {
                    this.submit();
                }
            });
        });
        
        // AnimaciÃ³n para botones de inscripciÃ³n
        document.querySelectorAll('button[type="submit"]').forEach(button => {
            button.addEventListener('click', function() {
                if (!this.disabled) {
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 150);
                }
            });
        });
    </script>
</body>
</html>
